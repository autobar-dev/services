# Realtime service
location /realtime {
  return 302 http://$host/realtime/;
}

# Add headers enabling WebSockets
location /realtime/ws {
  proxy_pass http://realtimeservice;

  proxy_http_version 1.1;
  proxy_set_header Upgrade $http_upgrade;
  proxy_set_header Connection "Upgrade";
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_set_header Host $proxy_host;

  # proxy_buffering off;
  # add_header Content-Type "text/event-stream";
  # add_header Connection "keep-alive";
  # add_header Cache-Controle "no-cache";
  # add_header X-Accel-Buffering "no";

  rewrite /realtime(.*) $1 break;
}

# Add headers enabling SSE
# location /realtime/eavesdrop {
#   proxy_pass http://realtimeservice;
#
#   proxy_buffering off;
#   add_header Content-Type "text/event-stream";
#   add_header Connection "keep-alive";
#   add_header Cache-Controle "no-cache";
#   add_header X-Accel-Buffering "no";
#
#   rewrite /realtime(.*) $1 break;
# }

location ^~ /realtime/ {
  proxy_pass http://realtimeservice;
  
  rewrite /realtime(.*) $1 break;
}
